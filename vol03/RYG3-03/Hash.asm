; ----------------------------------------

hash_mouse      byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00

hash_cat1       byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00

hash_cat2       byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00

hash_cat3       byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00

hash_cat4       byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00
                byte $00,$00,$00,$00,$00,$00,$00,$00

; ----------------------------------------

current_hash    byte $00

coll_mouse      byte $00
coll_cats       byte $00

hash_start      byte $ff
hash_dest       byte $ff

; ----------------------------------------

hashpos_mouse_start     byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        
hashpos_mouse_dest      byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff

hashpos_cats_start      byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        
hashpos_cats_dest       byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
                        byte $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff

; ----------------------------------------

seed    byte $00

randomize

        lda #$ff
        sta $d40e
        sta $d40f

        lda #%10000001
        sta $d412

randAgain

        lda $d41b
        beq randAgain

        sta seed

        jsr randHashMouse
        jsr randHashCat1
        jsr randHashCat2
        jsr randHashCat3
        jsr randHashCat4

        rts

; ----------------------------------------

rmTempX byte $00

randHashMouse

        stx rmTempX

        ldx #0

rmAgain

        lda $d41b
        beq rmAgain

        eor seed
        sta seed
        sta hash_mouse,x

        inx
        cpx #64
        bne rmAgain

        ldx rmTempX

        rts

; ----------------------------------------

rc1TempX        byte $00

randHashCat1

        stx rc1TempX

        ldx #0

rc1Again

        lda $d41b
        beq rc1Again

        eor seed
        sta seed
        sta hash_cat1,x

        inx
        cpx #64
        bne rc1Again

        ldx rc1TempX

        rts

; ----------------------------------------

rc2TempX        byte $00

randHashCat2

        stx rc2TempX

        ldx #0

rc2Again

        lda $d41b
        beq rc2Again

        eor seed
        sta seed
        sta hash_cat2,x

        inx
        cpx #64
        bne rc2Again

        ldx rc2TempX

        rts

; ----------------------------------------

rc3TempX        byte $00

randHashCat3

        stx rc3TempX

        ldx #0

rc3Again

        lda $d41b
        beq rc3Again

        eor seed
        sta seed
        sta hash_cat3,x

        inx
        cpx #64
        bne rc3Again

        ldx rc3TempX

        rts

; ----------------------------------------

rc4TempX        byte $00

randHashCat4

        stx rc4TempX

        ldx #0

rc4Again

        lda $d41b
        beq rc4Again

        eor seed
        sta seed
        sta hash_cat4,x

        inx
        cpx #64
        bne rc4Again

        ldx rc4TempX

        rts

; ----------------------------------------

admStart        byte $00
admDest         byte $00

admTempX        byte $00

addHashPosMouse

        stx admTempX

        ldx current_hash

        lda hashpos_mouse_start,x
        cmp #$ff
        beq admNoCol

        inc coll_mouse

admNoCol

        lda admStart
        sta hashpos_mouse_start,x

        lda admDest
        sta hashpos_mouse_dest,x

        ldx admTempX

        rts

; ----------------------------------------

adcStart        byte $00
adcDest         byte $00

adcTempX        byte $00

addHashPosCats

        stx adcTempX

        ldx current_hash

        lda hashpos_cats_start,x
        cmp #$ff
        beq adcNoCol

        inc coll_cats

adcNoCol

        lda adcStart
        sta hashpos_cats_start,x

        lda adcDest
        sta hashpos_cats_dest,x

        ldx adcTempX

        rts

; ----------------------------------------

uhPiece         byte $00
uhSquare        byte $00

uhTempX         byte $00

updateHash

        stx uhTempX

        lda uhPiece

uhMouse

        cmp #PIECE_MOUSE
        bne uhCat1

        ldx uhSquare
        lda hash_mouse,x

        eor current_hash
        sta current_hash
 
        jmp uhEnd
        
uhCat1

        cmp #PIECE_CAT1
        bne uhCat2

        ldx uhSquare
        lda hash_cat1,x

        eor current_hash
        sta current_hash

        jmp uhEnd

uhCat2

        cmp #PIECE_CAT2
        bne uhCat3

        ldx uhSquare
        lda hash_cat2,x

        eor current_hash
        sta current_hash

        jmp uhEnd

uhCat3

        cmp #PIECE_CAT3
        bne uhCat4

        ldx uhSquare
        lda hash_cat3,x

        eor current_hash
        sta current_hash

        jmp uhEnd

uhCat4

        cmp #PIECE_CAT4
        bne uhEnd

        ldx uhSquare
        lda hash_cat4,x

        eor current_hash
        sta current_hash

uhEnd

        ldx uhTempX

        rts

; ----------------------------------------

ghHash  byte $00
ghTempX byte $00

getHash

        stx ghTempX

        lda #0
        sta ghHash

        ldx #0

ghAgain

        lda board,x

ghMouse

        cmp #PIECE_MOUSE
        bne ghCat1

        lda hash_mouse,x

        eor ghHash
        sta ghHash

        jmp ghNext
        
ghCat1

        cmp #PIECE_CAT1
        bne ghCat2

        lda hash_cat1,x

        eor ghHash
        sta ghHash

        jmp ghNext

ghCat2

        cmp #PIECE_CAT2
        bne ghCat3

        lda hash_cat2,x

        eor ghHash
        sta ghHash

        jmp ghNext

ghCat3

        cmp #PIECE_CAT3
        bne ghCat4

        lda hash_cat3,x

        eor ghHash
        sta ghHash

        jmp ghNext

ghCat4

        cmp #PIECE_CAT4
        bne ghNext

        lda hash_cat4,x

        eor ghHash
        sta ghHash

ghNext

        inx
        cpx #64
        bne ghAgain

        ldx ghTempX

        rts

; ----------------------------------------

lumTempX        byte $00

lookUpMouse

        stx lumTempX

        ldx current_hash

        lda hashpos_mouse_start,x
        cmp #$ff
        bne lumTrue

lumFalse

        sta hash_start
        sta hash_dest

        jmp lumEnd

lumTrue

        lda hashpos_mouse_start,x
        sta hash_start

        lda hashpos_mouse_dest,x
        sta hash_dest

lumEnd

        ldx lumTempX

        rts

; ----------------------------------------

lucTempX        byte $00

lookUpCats

        stx lucTempX

        ldx current_hash

        lda hashpos_cats_start,x
        cmp #$ff
        bne lucTrue

lucFalse

        sta hash_start
        sta hash_dest

        jmp lucEnd

lucTrue

        lda hashpos_cats_start,x
        sta hash_start

        lda hashpos_cats_dest,x
        sta hash_dest

lucEnd

        ldx lucTempX

        rts

; ----------------------------------------
